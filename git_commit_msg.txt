feat: refactor authentication flow and user context integration